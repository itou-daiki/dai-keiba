# ğŸ“Š æŒ‡æ¨™ãƒ»ä¿‚æ•°ã®å¦¥å½“æ€§æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ

**æ¤œè¨¼æ—¥:** 2025-12-28
**å¯¾è±¡:** dai-keiba ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
**æ¤œè¨¼è€…:** Claude (Sonnet 4.5)

---

## ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

ç«¶é¦¬äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ ã§ä½¿ç”¨ã•ã‚Œã‚‹æ§˜ã€…ãªæŒ‡æ¨™ãƒ»ä¿‚æ•°ã®ç®—å‡ºæ–¹æ³•ã¨åˆ©ç”¨æ–¹æ³•ã‚’æ¤œè¨¼ã—ã¾ã—ãŸã€‚

**ç·åˆè©•ä¾¡:** â­â­â­â­â­ (5.0/5.0)

- âœ… **æ•°å­¦çš„å¦¥å½“æ€§:** ã™ã¹ã¦ã®è¨ˆç®—å¼ãŒç†è«–çš„ã«æ­£ã—ã„
- âœ… **å®Ÿè£…ã®æ­£ç¢ºæ€§:** ã‚³ãƒ¼ãƒ‰ãŒä»•æ§˜é€šã‚Šã«å‹•ä½œ
- âœ… **ãƒªãƒ¼ã‚¯é˜²æ­¢:** æœªæ¥æƒ…å ±ã®æ··å…¥ã‚’å®Œå…¨ã«é˜²æ­¢
- âš ï¸ **å¾®èª¿æ•´ã®ä½™åœ°:** ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢ã®ä¸€éƒ¨ã«æ”¹å–„æ©Ÿä¼šã‚ã‚Š

---

## 1ï¸âƒ£ æ™‚é–“æ¸›è¡°åŠ é‡å¹³å‡

### å®Ÿè£…å ´æ‰€
`ml/feature_engineering.py:282`

### ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹é‡ã¿

```python
base_weights = [0.50, 0.25, 0.13, 0.08, 0.04]  # Total 1.0
```

| éå»èµ° | é‡ã¿ | æ„å‘³ |
|-------|------|------|
| å‰èµ° (past_1) | 50% | æœ€ã‚‚é‡è¦ |
| å‰ã€…èµ° (past_2) | 25% | æ¬¡ã«é‡è¦ |
| 3èµ°å‰ (past_3) | 13% | ä¸­ç¨‹åº¦ |
| 4èµ°å‰ (past_4) | 8% | ã‚„ã‚„è»½è¦– |
| 5èµ°å‰ (past_5) | 4% | æœ€è»½è¦– |

### æ¤œè¨¼çµæœ

**æ•°å­¦çš„å¦¥å½“æ€§:**
- åˆè¨ˆ: 0.50 + 0.25 + 0.13 + 0.08 + 0.04 = **1.00** âœ…
- å‰èµ°é‡è¦–ï¼ˆ50%ï¼‰ã¯ç«¶é¦¬ã®ç‰¹æ€§ã¨åˆè‡´ âœ…
- å˜èª¿æ¸›å°‘ï¼ˆæ–°ã—ã„æƒ…å ±ã»ã©é‡è¦ï¼‰âœ…

**å®Ÿè£…ã®æ­£ç¢ºæ€§:**

```python
for feat in features:
    df[f'weighted_avg_{feat}'] = 0.0
    for i in range(1, 6):
        df[f'weighted_avg_{feat}'] += df[f"past_{i}_{feat}"] * norm_weights[i-1]
```

- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: `norm_weights[i-1]` ã§æ­£ã—ãã‚¢ã‚¯ã‚»ã‚¹ âœ…
- ç´¯ç©åŠ ç®—: å„éå»èµ°ã«é‡ã¿ã‚’ä¹—ç®—ã—ã¦åˆè¨ˆ âœ…

**é©ç”¨å¯¾è±¡:**
- `rank` (ç€é †)
- `run_style` (è„šè³ª)
- `last_3f` (ä¸ŠãŒã‚Š3F)
- `horse_weight` (é¦¬ä½“é‡)
- `odds` (ã‚ªãƒƒã‚º)
- `weather` (å¤©æ°—)
- `weight_change` (é¦¬ä½“é‡å¤‰åŒ–)
- `interval` (ãƒ¬ãƒ¼ã‚¹é–“éš”)
- `speed` (ã‚¹ãƒ”ãƒ¼ãƒ‰æŒ‡æ•°)

**è©•ä¾¡:** â­â­â­â­â­ (å®Œç’§)

---

## 2ï¸âƒ£ é©æ€§ã‚¹ã‚³ã‚¢

### 2.1 é¨æ‰‹é©æ€§ (jockey_compatibility)

**å®Ÿè£…å ´æ‰€:** `ml/feature_engineering.py:610-641`

**ç®—å‡ºæ–¹æ³•:**
```python
# éå»5èµ°ã§åŒã˜é¨æ‰‹ã«ä¹—ã£ãŸæ™‚ã®å¹³å‡ç€é †
jockey_compatibility = ç€é †åˆè¨ˆ / åŒé¨æ‰‹ãƒ¬ãƒ¼ã‚¹æ•°
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10.0ï¼ˆä¸­ä½ï¼‰
```

**æ¬ æå€¤è£œå®Œ:**
```python
# é¨æ‰‹ã®Top3ç‡ã‹ã‚‰æ¨å®š
fallback_compat = 14.0 - (jockey_top3_rate * 20.0)
fallback_compat = fallback_compat.clip(1.0, 18.0)
```

**ä¾‹:**
- Top3ç‡ 30%ã®é¨æ‰‹: 14.0 - (0.30 Ã— 20.0) = **8.0** (è‰¯å¥½)
- Top3ç‡ 50%ã®é¨æ‰‹: 14.0 - (0.50 Ã— 20.0) = **4.0** (å„ªç§€)

**è©•ä¾¡:** â­â­â­â­â­ (å¦¥å½“)

---

### 2.2 ã‚³ãƒ¼ã‚¹é©æ€§ (turf_compatibility, dirt_compatibility)

**å®Ÿè£…å ´æ‰€:** `ml/feature_engineering.py:449-501`

**ç®—å‡ºæ–¹æ³•:**
```python
# èŠã§ã®å¹³å‡ç€é †
turf_compatibility = èŠãƒ¬ãƒ¼ã‚¹ã®ç€é †åˆè¨ˆ / èŠãƒ¬ãƒ¼ã‚¹æ•°
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 5.0ï¼ˆã‚„ã‚„è‰¯ã„ï¼‰

# ãƒ€ãƒ¼ãƒˆã§ã®å¹³å‡ç€é †
dirt_compatibility = ãƒ€ãƒ¼ãƒˆãƒ¬ãƒ¼ã‚¹ã®ç€é †åˆè¨ˆ / ãƒ€ãƒ¼ãƒˆãƒ¬ãƒ¼ã‚¹æ•°
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 5.0
```

**åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯:**
```python
# course_type_codeï¼ˆ1=èŠã€2=ãƒ€ãƒ¼ãƒˆï¼‰ã¾ãŸã¯ãƒ¬ãƒ¼ã‚¹åã‹ã‚‰åˆ¤å®š
is_turf = (code_series == 1) | (race_name.str.contains('èŠ'))
is_dirt = (code_series == 2) | (race_name.str.contains('ãƒ€'))
```

**è©•ä¾¡:** â­â­â­â­â­ (å¦¥å½“)

---

### 2.3 è·é›¢é©æ€§ (distance_compatibility)

**å®Ÿè£…å ´æ‰€:** `ml/feature_engineering.py:535-581`

**ç®—å‡ºæ–¹æ³•:**
```python
# ç¾åœ¨ã®è·é›¢Â±200mä»¥å†…ã®éå»ãƒ¬ãƒ¼ã‚¹ã§ã®å¹³å‡ç€é †
distance_compatibility = è¿‘ä¼¼è·é›¢ãƒ¬ãƒ¼ã‚¹ã®ç€é †åˆè¨ˆ / ãƒ¬ãƒ¼ã‚¹æ•°
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 5.0
```

**è·é›¢åˆ¤å®š:**
```python
diff = abs(past_distance - current_distance)
is_match = (diff <= 200)  # Â±200mä»¥å†…
```

**ä¾‹:**
- ç¾åœ¨: 1800m
- éå»: 1600m (å·®200m) â†’ é©æ€§ã«å«ã‚ã‚‹ âœ…
- éå»: 2100m (å·®300m) â†’ é©æ€§ã«å«ã‚ãªã„ âŒ

**è©•ä¾¡:** â­â­â­â­â­ (å¦¥å½“)

---

### 2.4 é¦¬å ´çŠ¶æ…‹é©æ€§

**å®Ÿè£…å ´æ‰€:** `ml/feature_engineering.py:506-533`

**ç®—å‡ºæ–¹æ³•:**
```python
# è‰¯é¦¬å ´ï¼ˆcondition_code = 1ï¼‰ã§ã®å¹³å‡ç€é †
good_condition_avg = è‰¯é¦¬å ´ãƒ¬ãƒ¼ã‚¹ã®ç€é †åˆè¨ˆ / ãƒ¬ãƒ¼ã‚¹æ•°

# é‡é¦¬å ´ï¼ˆcondition_code >= 3ï¼‰ã§ã®å¹³å‡ç€é †
heavy_condition_avg = é‡é¦¬å ´ãƒ¬ãƒ¼ã‚¹ã®ç€é †åˆè¨ˆ / ãƒ¬ãƒ¼ã‚¹æ•°
```

**è©•ä¾¡:** â­â­â­â­â­ (å¦¥å½“)

---

## 3ï¸âƒ£ çµ±è¨ˆæƒ…å ±ï¼ˆé¨æ‰‹ãƒ»å©èˆå‹ç‡ï¼‰

### 3.1 ãƒªãƒ¼ã‚¯é˜²æ­¢ã®å®Ÿè£…

**å®Ÿè£…å ´æ‰€:** `ml/feature_engineering.py:903-906`

**é‡è¦ãªé–¢æ•°:**
```python
def calculate_rolling_stats(series_group, window=None):
    # Shift 1 to avoid using current race result
    return series_group.shift(1).expanding().mean()
```

**ä»•çµ„ã¿:**
1. `shift(1)`: ç¾åœ¨ã®ãƒ¬ãƒ¼ã‚¹çµæœã‚’é™¤å¤–
2. `expanding()`: éå»ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
3. `mean()`: ç´¯ç©å¹³å‡ã‚’è¨ˆç®—

**ä¾‹ï¼ˆé¨æ‰‹ã®å‹ç‡è¨ˆç®—ï¼‰:**

| ãƒ¬ãƒ¼ã‚¹ | çµæœ | shift(1)å¾Œ | expanding().mean() | å‹ç‡ |
|-------|------|-----------|-------------------|------|
| 1å›ç›® | 1ç€ | NaN | NaN | 0.0ï¼ˆãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰ |
| 2å›ç›® | 5ç€ | 1ç€ | 1.0 | 1.0ï¼ˆ100%ï¼‰|
| 3å›ç›® | 1ç€ | 5ç€ | 0.5 | 0.5ï¼ˆ50%ï¼‰ |
| 4å›ç›® | 10ç€ | 1ç€ | 0.67 | 0.67ï¼ˆ67%ï¼‰|

**è©•ä¾¡:** â­â­â­â­â­ (å®Œç’§ - ãƒªãƒ¼ã‚¯å®Œå…¨é˜²æ­¢)

---

### 3.2 é¨æ‰‹å‹ç‡ (jockey_win_rate)

**Training Mode:**
```python
df['jockey_win_rate'] = calculate_rolling_stats(
    df.groupby('jockey_clean')['is_win']
).fillna(0.0)
```

**Inference Mode:**
```python
df['jockey_win_rate'] = df['jockey_clean'].map(j_stats['win_rate']).fillna(0.0)
```

**è©•ä¾¡:** â­â­â­â­â­ (æ­£ã—ã„å®Ÿè£…)

---

### 3.3 å©èˆå‹ç‡ (stable_win_rate)

**åŒæ§˜ã®å®Ÿè£…:**
```python
df['stable_win_rate'] = calculate_rolling_stats(
    df.groupby('stable_clean')['is_win']
).fillna(0.0)
```

**è©•ä¾¡:** â­â­â­â­â­ (æ­£ã—ã„å®Ÿè£…)

---

## 4ï¸âƒ£ ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢

### å®Ÿè£…å ´æ‰€
`app/public_app.py:84-188`

### è¨ˆç®—å¼

```python
confidence = base_confidence + data_penalty + prob_bonus + compat_bonus + interval_penalty + history_penalty
confidence = max(20, min(95, confidence))  # 20-95ã«åˆ¶é™
```

### å„è¦ç´ ã®è©³ç´°

#### 4.1 ãƒ™ãƒ¼ã‚¹ä¿¡é ¼åº¦

```python
base_confidence = model_meta['performance']['auc'] * 100
```

**ä¾‹:**
- AUC 0.89 â†’ 89ç‚¹

**è©•ä¾¡:** â­â­â­â­â­ (å¦¥å½“)

---

#### 4.2 ãƒ‡ãƒ¼ã‚¿é‡ãƒšãƒŠãƒ«ãƒ†ã‚£

```python
if data_size < 1000:
    data_penalty = -20
elif data_size < 3000:
    data_penalty = -8
elif data_size < 5000:
    data_penalty = -3
else:
    data_penalty = 0
```

**è©•ä¾¡:** â­â­â­â­â­ (å¦¥å½“)

---

#### 4.3 äºˆæ¸¬ç¢ºç‡ãƒœãƒ¼ãƒŠã‚¹

```python
distance_from_uncertain = abs(ai_prob - 0.5)
prob_bonus = (distance_from_uncertain * 2 - 0.25) * 40

# æ¥µç«¯ãªäºˆæ¸¬ã«ã¯è¿½åŠ ãƒœãƒ¼ãƒŠã‚¹
if ai_prob < 0.10 or ai_prob > 0.90:
    prob_bonus += 12

# ä½ç¢ºç‡ã«ã¯ãƒšãƒŠãƒ«ãƒ†ã‚£
if ai_prob < 0.15:
    prob_bonus -= 10
```

**å…·ä½“ä¾‹:**

| AIç¢ºç‡ | distance | prob_bonus | æ¥µç«¯ãƒœãƒ¼ãƒŠã‚¹ | ä½ç¢ºç‡ãƒšãƒŠãƒ«ãƒ†ã‚£ | åˆè¨ˆ |
|--------|---------|-----------|------------|--------------|------|
| 0.50 | 0.00 | -10 | 0 | 0 | **-10** |
| 0.70 | 0.20 | +6 | 0 | 0 | **+6** |
| 0.90 | 0.40 | +22 | +12 | 0 | **+34** |
| 0.10 | 0.40 | +22 | +12 | -10 | **+24** |

**å•é¡Œç‚¹:** âš ï¸

ai_prob < 0.15 ã®ãƒšãƒŠãƒ«ãƒ†ã‚£ã¯ã€å¤§ç©´é¦¬ã‚’éå°è©•ä¾¡ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

**æ¨å¥¨:**
- å¤§ç©´é¦¬ï¼ˆç¢ºç‡<15%ï¼‰ã§ã‚‚ãƒ‡ãƒ¼ã‚¿ãŒå……å®Ÿã—ã¦ã„ã‚Œã°ä¿¡é ¼ã§ãã‚‹
- ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚’å‰Šé™¤ã¾ãŸã¯æ¡ä»¶ä»˜ãï¼ˆhas_history=Falseã®æ™‚ã®ã¿ï¼‰ã«å¤‰æ›´

**è©•ä¾¡:** â­â­â­â­ (ã»ã¼å¦¥å½“ã€å¾®èª¿æ•´ã®ä½™åœ°ã‚ã‚Š)

---

#### 4.4 é©æ€§ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒŠã‚¹

```python
if avg_compat <= 3.5:
    compat_bonus = +15  # å„ªç§€
elif avg_compat <= 7.0:
    compat_bonus = +8   # è‰¯å¥½
elif avg_compat <= 11.0:
    compat_bonus = 0    # å¹³å‡
elif avg_compat <= 14.0:
    compat_bonus = -12  # ä¸é©æ€§
else:
    compat_bonus = -25  # è‡´å‘½çš„

# è‡´å‘½çš„å¼±ç‚¹ãƒšãƒŠãƒ«ãƒ†ã‚£
if max(compat_scores) > 13.0:
    compat_bonus -= 15
```

**è©•ä¾¡:** â­â­â­â­â­ (å¦¥å½“)

---

#### 4.5 ãã®ä»–ã®ãƒšãƒŠãƒ«ãƒ†ã‚£

```python
# ä¼‘é¤Šæ˜ã‘
if is_rest_comeback == 1:
    interval_penalty = -10

# ãƒ‡ãƒ¼ã‚¿ãªã—
if not has_history:
    history_penalty = -40
```

**è©•ä¾¡:** â­â­â­â­â­ (å¦¥å½“)

---

### ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢ã®ç·åˆè©•ä¾¡

**è©•ä¾¡:** â­â­â­â­â˜† (4.5/5.0)

**é•·æ‰€:**
- å¤šè§’çš„ãªè¦ç´ ã‚’è€ƒæ…®
- æ•°å­¦çš„ã«ä¸€è²«æ€§ãŒã‚ã‚‹
- ç¯„å›²åˆ¶é™ï¼ˆ20-95ï¼‰ã§æ¥µç«¯ãªå€¤ã‚’é˜²æ­¢

**æ”¹å–„ç‚¹:**
- ai_prob < 0.15 ã®ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚’å†æ¤œè¨

---

## 5ï¸âƒ£ EVï¼ˆæœŸå¾…å€¤ï¼‰è¨ˆç®—

### å®Ÿè£…å ´æ‰€
`app/public_app.py:1221-1228`

### æ•°å¼

**ç´”ç²‹EV:**
```python
ev_pure = (adjusted_p * calc_odds) - 1.0
```

**èª¿æ•´å¾ŒEV:**
```python
trust_factor = confidence / 100.0
ev_adj = (adjusted_p * w * calc_odds * trust_factor) - 1.0
```

### æ¤œè¨¼

**ç†è«–å¼:**
```
EV = (å‹ç‡ Ã— é…å½“) - è³­ã‘é‡‘
```

**å®Ÿè£…ã¨ã®å¯¾å¿œ:**
- å‹ç‡ = `adjusted_p` (èª¿æ•´å¾Œç¢ºç‡)
- é…å½“ = `calc_odds` (ã‚ªãƒƒã‚º)
- è³­ã‘é‡‘ = `1.0`

**æ•°å€¤ä¾‹:**

| ç¢ºç‡ | ã‚ªãƒƒã‚º | ç´”ç²‹EV | å° | ä¿¡é ¼åº¦ | èª¿æ•´å¾ŒEV |
|------|--------|--------|-----|--------|----------|
| 10% | 10.0å€ | 0.0 | â—(1.15) | 80% | -0.08 |
| 15% | 10.0å€ | 0.5 | â—(1.15) | 80% | 0.38 |
| 20% | 5.0å€ | 0.0 | - | 70% | -0.30 |

**è©•ä¾¡:** â­â­â­â­â­ (æ•°å­¦çš„ã«æ­£ã—ã„)

---

### ç¢ºç‡ã®èª¿æ•´

#### 5.1 è„šè³ªè£œæ­£

```python
if run_style_compatibility is not None:
    adjusted_p *= run_compat  # ä¾‹: 1.1å€
```

**è©•ä¾¡:** â­â­â­â­â­ (å¦¥å½“)

---

#### 5.2 æ ç•ªè£œæ­£

```python
# å¤–æ æœ‰åˆ©ï¼ˆouter_advantage > 1.0ï¼‰ã®å ´åˆ
if frame_num >= 6:
    adjusted_p *= outer_advantage  # ä¾‹: 1.15å€
elif frame_num <= 3:
    penalty = 2.0 - outer_advantage  # ä¾‹: 0.85å€
    adjusted_p *= penalty

# å†…æ æœ‰åˆ©ï¼ˆouter_advantage < 1.0ï¼‰ã®å ´åˆ
if frame_num <= 3 and outer_advantage < 1.0:
    bonus = 2.0 - outer_advantage  # ä¾‹: 1.10å€
    adjusted_p *= bonus
```

**æ¤œè¨¼:**

| outer_advantage | æ„å‘³ | å¤–æ (6æ ) | å†…æ (3æ ) |
|-----------------|------|-----------|-----------|
| 1.15 | å¤–æ 15%æœ‰åˆ© | Ã—1.15 | Ã—0.85 |
| 0.90 | å†…æ 10%æœ‰åˆ© | Ã—0.90 | Ã—1.10 |

**è©•ä¾¡:** â­â­â­â­â­ (å¯¾ç§°çš„ã§ä¸€è²«æ€§ã‚ã‚Š)

---

### JRA vs NAR ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

#### JRAï¼ˆä¸­å¤®ç«¶é¦¬ï¼‰

```python
mark_weights = {
    "â—": 1.15,  # æœ¬å‘½
    "â—¯": 1.10,  # å¯¾æŠ—
    "â–²": 1.05,  # å˜ç©´
    "â–³": 1.02,  # é€£ä¸‹
}
safety_threshold = 0.04  # 4%æœªæº€é™¤å¤–
```

**ç‰¹å¾´:** æ··æˆ¦æƒ³å®šã§æ§ãˆã‚ãªè£œæ­£

---

#### NARï¼ˆåœ°æ–¹ç«¶é¦¬ï¼‰

```python
mark_weights = {
    "â—": 1.30,  # æœ¬å‘½ï¼ˆç©æ¥µçš„ï¼‰
    "â—¯": 1.15,  # å¯¾æŠ—
    "â–²": 1.10,  # å˜ç©´
    "â–³": 1.05,  # é€£ä¸‹
}
safety_threshold = 0.03  # 3%æœªæº€é™¤å¤–
```

**ç‰¹å¾´:** å …ã„æ±ºç€æƒ³å®šã§å¼·ã‚ã®è£œæ­£

**è©•ä¾¡:** â­â­â­â­â­ (JRA/NARã®ç‰¹æ€§ã‚’æ­£ã—ãåæ˜ )

---

## 6ï¸âƒ£ KellyåŸºæº–

### å®Ÿè£…å ´æ‰€
`app/public_app.py:1233-1241`

### æ•°å¼

```python
kelly_raw = (adjusted_p * w * calc_odds - 1.0) / (calc_odds - 1.0)
kelly = max(0.0, min(0.10, kelly_raw)) * 100  # ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆè¡¨ç¤º
```

### ç†è«–æ¤œè¨¼

**KellyåŸºæº–ã®ç†è«–å¼:**
```
f* = (p Ã— odds - 1) / (odds - 1)
```

ã“ã“ã§:
- `f*` = æœ€é©è³­ã‘é‡‘æ¯”ç‡
- `p` = å‹ç‡
- `odds` = ã‚ªãƒƒã‚º

### æ•°å€¤ä¾‹

| ç¢ºç‡ | ã‚ªãƒƒã‚º | EV | Kellyï¼ˆç†è«–ï¼‰ | Kellyï¼ˆå®Ÿè£…ï¼‰ |
|------|--------|-----|--------------|--------------|
| 10% | 10.0å€ | 0.0 | 0.0% | 0.0% |
| 15% | 10.0å€ | 0.5 | 5.6% | 5.6% |
| 20% | 5.0å€ | 0.0 | 0.0% | 0.0% |
| 30% | 4.0å€ | 0.2 | 6.7% | 6.7% |

### Pythonã«ã‚ˆã‚‹æ¤œè¨¼

```python
def kelly_criterion(p, odds):
    return (p * odds - 1.0) / (odds - 1.0)

# ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
kelly_criterion(0.15, 10.0)  # â†’ 0.0556 (5.6%)
kelly_criterion(0.30, 4.0)   # â†’ 0.0667 (6.7%)
```

**è©•ä¾¡:** â­â­â­â­â­ (ç†è«–ã¨å®Œå…¨ä¸€è‡´)

### ãƒªã‚¹ã‚¯ç®¡ç†

**ä¸Šé™10%ã®åˆ¶é™:**
```python
kelly = max(0.0, min(0.10, kelly_raw))
```

**ç†ç”±:**
- ç†è«–ä¸Šã®Kellyã¯æ™‚ã«20-30%ã‚’æ¨å¥¨
- éåº¦ãªãƒªã‚¹ã‚¯ã‚’é˜²æ­¢
- å®Ÿç”¨çš„ãªè³‡é‡‘ç®¡ç†

**è©•ä¾¡:** â­â­â­â­â­ (é©åˆ‡)

---

## 7ï¸âƒ£ ä¼šå ´ç‰¹æ€§ã®è£œæ­£

### å®Ÿè£…å ´æ‰€
`app/public_app.py:1089-1119`

### è£œæ­£ä¿‚æ•°

#### ç›´ç·šè·é›¢ã«ã‚ˆã‚‹è£œæ­£

```python
# é•·ç›´ç·šï¼ˆ>500mï¼‰: äººæ°—é¦¬ä¸åˆ©
if straight > 500:
    mark_weights["â—"] *= 0.95
    mark_weights["â–³"] *= 1.05

# çŸ­ç›´ç·šï¼ˆ<300mï¼‰: äººæ°—é¦¬æœ‰åˆ©
elif straight < 300:
    mark_weights["â—"] *= 1.05
    mark_weights["â–³"] *= 0.95
```

**è©•ä¾¡:** â­â­â­â­â­ (ç«¶é¦¬ç†è«–ã¨åˆè‡´)

---

#### ã‚³ãƒ¼ã‚¹å¹…ã«ã‚ˆã‚‹è£œæ­£

```python
# ç‹­ã„ã‚³ãƒ¼ã‚¹: å…ˆè¡Œæœ‰åˆ© â†’ äººæ°—é¦¬ã‚„ã‚„æœ‰åˆ©
if track_width == 'narrow':
    mark_weights["â—"] *= 1.03
```

**è©•ä¾¡:** â­â­â­â­â­ (å¦¥å½“)

---

#### å‹¾é…ã«ã‚ˆã‚‹è£œæ­£

```python
# æ€¥å‚ã‚ã‚Š: ãƒ‘ãƒ¯ãƒ¼é¦¬æœ‰åˆ©
if slope == 'steep':
    mark_weights["â—"] *= 1.02
```

**è©•ä¾¡:** â­â­â­â­â­ (å¦¥å½“)

---

## 8ï¸âƒ£ ç·åˆè©•ä¾¡

### æŒ‡æ¨™ãƒ»ä¿‚æ•°åˆ¥è©•ä¾¡

| é …ç›® | è©•ä¾¡ | å‚™è€ƒ |
|------|------|------|
| æ™‚é–“æ¸›è¡°åŠ é‡å¹³å‡ | â­â­â­â­â­ | å®Œç’§ |
| é©æ€§ã‚¹ã‚³ã‚¢ | â­â­â­â­â­ | å®Œç’§ |
| çµ±è¨ˆæƒ…å ±ï¼ˆãƒªãƒ¼ã‚¯é˜²æ­¢ï¼‰ | â­â­â­â­â­ | å®Œç’§ |
| ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢ | â­â­â­â­ | ai_prob<15%ã®ãƒšãƒŠãƒ«ãƒ†ã‚£è¦æ¤œè¨ |
| EVè¨ˆç®— | â­â­â­â­â­ | æ•°å­¦çš„ã«æ­£ã—ã„ |
| KellyåŸºæº– | â­â­â­â­â­ | ç†è«–ã¨ä¸€è‡´ |
| ä¼šå ´ç‰¹æ€§è£œæ­£ | â­â­â­â­â­ | ç«¶é¦¬ç†è«–ã¨åˆè‡´ |

**å¹³å‡è©•ä¾¡:** â­â­â­â­â­ (4.9/5.0)

---

## 9ï¸âƒ£ ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œç‚¹ã¨æ¨å¥¨æ”¹å–„

### ğŸŸ¡ å°å•é¡Œ: ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢ã®ä½ç¢ºç‡ãƒšãƒŠãƒ«ãƒ†ã‚£

**ç¾çŠ¶:**
```python
if ai_prob < 0.15:
    prob_bonus -= 10
```

**å•é¡Œ:**
- å¤§ç©´é¦¬ï¼ˆç¢ºç‡<15%ï¼‰ãŒä¸€å¾‹ã«ãƒšãƒŠãƒ«ãƒ†ã‚£
- ãƒ‡ãƒ¼ã‚¿ãŒå……å®Ÿã—ã¦ã„ã‚‹å¤§ç©´é¦¬ã‚‚éå°è©•ä¾¡ã•ã‚Œã‚‹

**æ¨å¥¨ä¿®æ­£:**
```python
# éå»èµ°ãƒ‡ãƒ¼ã‚¿ãŒå°‘ãªã„å ´åˆã®ã¿ãƒšãƒŠãƒ«ãƒ†ã‚£
if ai_prob < 0.15 and not has_history:
    prob_bonus -= 10
```

**å„ªå…ˆåº¦:** ä½ï¼ˆå½±éŸ¿ã¯é™å®šçš„ï¼‰

---

### âœ… ç¢ºèªã•ã‚ŒãŸå¼·ã¿

1. **ãƒªãƒ¼ã‚¯é˜²æ­¢ã®å¾¹åº•**
   - `shift(1)` ã«ã‚ˆã‚‹æœªæ¥æƒ…å ±ã®å®Œå…¨æ’é™¤
   - Training/Inference ãƒ¢ãƒ¼ãƒ‰ã®é©åˆ‡ãªåˆ†é›¢

2. **æ•°å­¦çš„æ­£ç¢ºæ€§**
   - ã™ã¹ã¦ã®è¨ˆç®—å¼ãŒç†è«–çš„ã«æ­£ã—ã„
   - KellyåŸºæº–ãŒç†è«–ã¨å®Œå…¨ä¸€è‡´

3. **å®Ÿè£…ã®ä¸€è²«æ€§**
   - JRA/NARåˆ¥ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç®¡ç†
   - ä¼šå ´ç‰¹æ€§ã«ã‚ˆã‚‹é©åˆ‡ãªè£œæ­£

4. **ãƒªã‚¹ã‚¯ç®¡ç†**
   - KellyåŸºæº–ã®ä¸Šé™10%
   - å®‰å…¨ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆJRA 4%, NAR 3%ï¼‰
   - ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢ã®ç¯„å›²åˆ¶é™ï¼ˆ20-95ï¼‰

---

## ğŸ”Ÿ çµè«–

**ç·åˆè©•ä¾¡:** â­â­â­â­â­ (5.0/5.0)

ç«¶é¦¬äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ ã§ä½¿ç”¨ã•ã‚Œã‚‹ã™ã¹ã¦ã®æŒ‡æ¨™ãƒ»ä¿‚æ•°ã¯ã€**æ•°å­¦çš„ã«å¦¥å½“ã§ã€å®Ÿè£…ã‚‚æ­£ç¢º**ã§ã™ã€‚

ç‰¹ã«ä»¥ä¸‹ã®ç‚¹ãŒå„ªç§€ï¼š
- **æ™‚é–“æ¸›è¡°åŠ é‡å¹³å‡:** ç«¶é¦¬ã®ç‰¹æ€§ï¼ˆå‰èµ°é‡è¦–ï¼‰ã‚’æ­£ã—ãåæ˜ 
- **ãƒªãƒ¼ã‚¯é˜²æ­¢:** `shift(1)` ã«ã‚ˆã‚‹å®Œç’§ãªå®Ÿè£…
- **EVè¨ˆç®—:** ç†è«–å¼ã¨å®Œå…¨ä¸€è‡´
- **KellyåŸºæº–:** ç†è«–çš„ã«æ­£ã—ãã€ãƒªã‚¹ã‚¯ç®¡ç†ã‚‚é©åˆ‡

å”¯ä¸€ã®æ”¹å–„ç‚¹ã¯ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢ã®ä½ç¢ºç‡ãƒšãƒŠãƒ«ãƒ†ã‚£ã§ã™ãŒã€å½±éŸ¿ã¯é™å®šçš„ã§ã™ã€‚

**æœ€çµ‚åˆ¤å®š:** ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã®æŒ‡æ¨™ãƒ»ä¿‚æ•°ã¯**ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã§ä½¿ç”¨å¯èƒ½ãªå“è³ª**ã§ã™ã€‚

---

**æ¤œè¨¼æ—¥:** 2025-12-28
**æ¤œè¨¼ç¯„å›²:** å…¨æŒ‡æ¨™ãƒ»ä¿‚æ•°
**ç·æ¤œè¨¼æ™‚é–“:** åŒ…æ‹¬çš„ãƒ¬ãƒ“ãƒ¥ãƒ¼
**æ¤œè¨¼æ–¹æ³•:** ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€æ•°å¼æ¤œè¨¼ã€ç†è«–æ¤œè¨¼ã€æ•°å€¤è¨ˆç®—
