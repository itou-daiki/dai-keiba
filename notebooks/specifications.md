# ğŸ“š ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ä»•æ§˜æ›¸ (v2)

ä»¥ä¸‹ã«ã€`notebooks/` å†…ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ (`v2`å½¢å¼) ã®ä»•æ§˜ã‚’è¨˜è¼‰ã™ã‚‹ã€‚

---

## ğŸš€ å®Ÿè¡Œé †åº

### JRAç”¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
```
Step 1: Colab_ID_Fetcher.ipynb
        â†’ race_ids.csv (ãƒ¬ãƒ¼ã‚¹IDä¸€è¦§)

Step 2: Colab_JRA_Basic_v2.ipynb
        â†’ database_jra_basic.csv (åŸºæœ¬ãƒ¬ãƒ¼ã‚¹çµæœ)

Step 3: Colab_History_Generator.ipynb (MODE = 'JRA')
        â†’ database_jra_with_history.csv (éå»5èµ°ä»˜ã)
        â€» JRA + NAR ä¸¡æ–¹ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰éå»èµ°ã‚’æ¤œç´¢ï¼ˆã‚¯ãƒ­ã‚¹ãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œï¼‰

Step 4: Colab_Pedigree_Scraper.ipynb (MODE = 'JRA')
        â†’ database_jra_pedigree.csv (è¡€çµ±ãƒ‡ãƒ¼ã‚¿)
```

### NARç”¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
```
Step 1: Colab_ID_Fetcher.ipynb
        â†’ race_ids_nar.csv (ãƒ¬ãƒ¼ã‚¹IDä¸€è¦§)

Step 2: Colab_NAR_Basic_v2.ipynb
        â†’ database_nar_basic.csv (åŸºæœ¬ãƒ¬ãƒ¼ã‚¹çµæœ)

Step 3: Colab_History_Generator.ipynb (MODE = 'NAR')
        â†’ database_nar_with_history.csv (éå»5èµ°ä»˜ã)
        â€» JRA + NAR ä¸¡æ–¹ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰éå»èµ°ã‚’æ¤œç´¢ï¼ˆã‚¯ãƒ­ã‚¹ãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œï¼‰

Step 4: Colab_Pedigree_Scraper.ipynb (MODE = 'NAR')
        â†’ database_nar_pedigree.csv (è¡€çµ±ãƒ‡ãƒ¼ã‚¿)
```

> [!IMPORTANT]
> **Step 3 (History Generator)** ã¯ HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸è¦ã€‚æ•°åˆ†ã§å®Œäº†ã—ã€IPåˆ¶é™ã®å¿ƒé…ãªã—ã€‚
> äº¤æµç«¶èµ°ãƒ»è»¢ç±é¦¬ã®å±¥æ­´ã‚‚æ­£ã—ãå–å¾—ã•ã‚Œã¾ã™ã€‚

---

## ğŸ—ï¸ å…¨ä½“æ§‹æˆ

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
| ç¨®é¡ | ãƒ•ã‚¡ã‚¤ãƒ«å | å½¹å‰² |
|---|---|---|
| **IDå–å¾—** | `Colab_ID_Fetcher.ipynb` | ãƒ¬ãƒ¼ã‚¹IDä¸€è¦§ã‚’å–å¾— |
| **åŸºæœ¬æƒ…å ± (JRA)** | `Colab_JRA_Basic_v2.ipynb` | JRAãƒ¬ãƒ¼ã‚¹ã®åŸºæœ¬çµæœã‚’å–å¾— |
| **åŸºæœ¬æƒ…å ± (NAR)** | `Colab_NAR_Basic_v2.ipynb` | NARãƒ¬ãƒ¼ã‚¹ã®åŸºæœ¬çµæœã‚’å–å¾— |
| **éå»èµ°ç”Ÿæˆ** | `Colab_History_Generator.ipynb` | è‡ªå·±çµåˆã§éå»5èµ°ã‚’ç”Ÿæˆï¼ˆHTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸è¦ï¼‰ |
| **è¡€çµ±å–å¾—** | `Colab_Pedigree_Scraper.ipynb` | è¡€çµ±ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’è»½é‡å–å¾— |

### æ—§ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå‚è€ƒç”¨ãƒ»éæ¨å¥¨ï¼‰
| ãƒ•ã‚¡ã‚¤ãƒ«å | çŠ¶æ…‹ |
|---|---|
| `Colab_JRA_Details_v2.ipynb` | âš ï¸ éæ¨å¥¨: History Generator + Pedigree Scraperã«ç½®ãæ›ãˆ |
| `Colab_NAR_Details_v2.ipynb` | âš ï¸ éæ¨å¥¨: History Generator + Pedigree Scraperã«ç½®ãæ›ãˆ |

---

## 1. åŸºæœ¬æƒ…å ±ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚° (Basic)

### ğŸ“¥ å…¥åŠ›
- **JRA**: `data/raw/race_ids.csv`
- **NAR**: `data/raw/race_ids_nar.csv`

### ğŸ“¤ å‡ºåŠ›
- **JRA**: `data/raw/database_jra_basic.csv`
- **NAR**: `data/raw/database_nar_basic.csv`

### ğŸ“Š ã‚«ãƒ©ãƒ ä»•æ§˜ (è¨ˆ32ã‚«ãƒ©ãƒ )
JRAãƒ»NARå…±é€šã§ä»¥ä¸‹ã®ã‚«ãƒ©ãƒ æ§‹æˆã‚’æŒã¤ï¼ˆ**å…¨32ã‚«ãƒ©ãƒ **ï¼‰ã€‚

| No. | ã‚«ãƒ©ãƒ å | èª¬æ˜ |
|---|---|---|
| 1-10 | `æ—¥ä»˜`, `ä¼šå ´`, `ãƒ¬ãƒ¼ã‚¹ç•ªå·`, `ãƒ¬ãƒ¼ã‚¹å`, `é‡è³`, `ã‚³ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—`, `è·é›¢`, `å›ã‚Š`, `å¤©å€™`, `é¦¬å ´çŠ¶æ…‹` | ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ |
| 11-16 | `ç€é †`, `æ `, `é¦¬ç•ª`, `é¦¬å`, `æ€§é½¢`, `æ–¤é‡` | åŸºæœ¬æƒ…å ± |
| 17 | `é¨æ‰‹` | **é¨æ‰‹ãƒ•ãƒ«ãƒãƒ¼ãƒ ** |
| 18-22 | `ã‚¿ã‚¤ãƒ `, `ç€å·®`, `äººæ°—`, `å˜å‹ã‚ªãƒƒã‚º`, `å¾Œ3F` | æˆç¸¾ |
| 23-26 | `corner_1`, `corner_2`, `corner_3`, `corner_4` | **ã‚³ãƒ¼ãƒŠãƒ¼é€šéé †** (åˆ†å‰²æ¸ˆã¿) |
| 27 | `å©èˆ` | æ‰€å± |
| 28 | `èª¿æ•™å¸«` | **èª¿æ•™å¸«ãƒ•ãƒ«ãƒãƒ¼ãƒ ** |
| 29 | `é¦¬ä½“é‡` | é¦¬ä½“é‡ (æ•°å€¤éƒ¨åˆ†) |
| 30 | `å¢—æ¸›` | ä½“é‡å¢—æ¸› (æ•°å€¤éƒ¨åˆ†, `+`é™¤å») |
| 31-32 | `race_id`, `horse_id` | ID |

---

## 2. éå»èµ°ç”Ÿæˆ (History Generator)

### ğŸ“¥ å…¥åŠ›
- `database_jra_basic.csv` + `database_nar_basic.csv` (ä¸¡æ–¹ã‚’å‚ç…§)

### ğŸ“¤ å‡ºåŠ›
- **JRA**: `database_jra_with_history.csv`
- **NAR**: `database_nar_with_history.csv`

### ğŸ”„ ã‚¯ãƒ­ã‚¹ãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œ
JRAé¦¬ãŒNARã§èµ°ã£ãŸå±¥æ­´ã€NARé¦¬ãŒJRAã§èµ°ã£ãŸå±¥æ­´ã‚‚æ­£ã—ãå–å¾—ã€‚
- äº¤æµé‡è³ï¼ˆãƒ•ã‚§ãƒ–ãƒ©ãƒªãƒ¼Sã€ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ã‚ºCãªã©ï¼‰
- åœ°æ–¹é å¾
- JRAâ†”NARè»¢ç±é¦¬

### ğŸ“Š éå»èµ°ã‚«ãƒ©ãƒ  (13é …ç›® Ã— 5èµ° = 65ã‚«ãƒ©ãƒ )
| é …ç›® | ã‚«ãƒ©ãƒ å |
|---|---|
| æ—¥ä»˜ | `past_N_date` |
| ç€é † | `past_N_rank` |
| ã‚¿ã‚¤ãƒ  | `past_N_time` |
| é¨æ‰‹ | `past_N_jockey` |
| é¦¬ä½“é‡ | `past_N_horse_weight` |
| å¢—æ¸› | `past_N_weight_change` |
| å¤©å€™ | `past_N_weather` |
| é¦¬å ´ | `past_N_condition` |
| è·é›¢ | `past_N_distance` |
| ã‚³ãƒ¼ã‚¹ | `past_N_course_type` |
| ä¸Šã‚Š | `past_N_last_3f` |
| ã‚ªãƒƒã‚º | `past_N_odds` |
| ãƒ¬ãƒ¼ã‚¹å | `past_N_race_name` |
| ä¼šå ´ | `past_N_venue` |

---

## 3. è¡€çµ±å–å¾— (Pedigree Scraper)

### ğŸ“¥ å…¥åŠ›
- **JRA**: `database_jra_basic.csv` (horse_id ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯å€¤)
- **NAR**: `database_nar_basic.csv` (horse_id ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯å€¤)

### ğŸ“¤ å‡ºåŠ›
- **JRA**: `database_jra_pedigree.csv`
- **NAR**: `database_nar_pedigree.csv`

### ğŸ“Š ã‚«ãƒ©ãƒ ä»•æ§˜ (4ã‚«ãƒ©ãƒ )
| ã‚«ãƒ©ãƒ å | èª¬æ˜ |
|---|---|
| `horse_id` | é¦¬ID |
| `father` | çˆ¶ |
| `mother` | æ¯ |
| `bms` | æ¯ã®çˆ¶ (Broodmare Sire) |

### âš¡ åŠ¹ç‡åŒ–
- åŒä¸€horse_idã¯1å›ã®ã¿ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
- Basicãƒ‡ãƒ¼ã‚¿ã‹ã‚‰éå»èµ°ã¯å–ã‚‰ãªã„ï¼ˆHistory Generatorã§ç”Ÿæˆæ¸ˆã¿ï¼‰
- **ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ã‚¤ã‚«ãƒ¼**: æˆåŠŸç‡20%æœªæº€ã§è‡ªå‹•åœæ­¢ï¼ˆIPåˆ¶é™å¯¾ç­–ï¼‰

---

## ğŸ›¡ï¸ å®‰å…¨æ©Ÿèƒ½

### Smart Skip
æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã§ `father` ãŒå…¥åŠ›æ¸ˆã¿ã®é¦¬ã¯ã‚¹ã‚­ãƒƒãƒ—ã€‚
é€”ä¸­åœæ­¢ã‹ã‚‰ã®å†é–‹æ™‚ã«é‡è¤‡ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚’é˜²æ­¢ã€‚

### Circuit Breaker
ç›´è¿‘20ä»¶ã®æˆåŠŸç‡ãŒ20%æœªæº€ã®å ´åˆã€IPåˆ¶é™ã¨åˆ¤æ–­ã—ã¦è‡ªå‹•åœæ­¢ã€‚
ç©ºãƒ‡ãƒ¼ã‚¿ã®å¤§é‡è“„ç©ã‚’é˜²æ­¢ã€‚

